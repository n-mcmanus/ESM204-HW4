---
title: "hw4"
author: "Nick McManus"
date: "5/21/2022"
output: 
  html_document:
    code_folding: hide
    theme: cerulean
    toc: yes
    toc_depth: 5
    toc_float: yes
    collapsed: yes
    smooth_scroll: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(equatiomatic)
```

```{r}
# read in data
warming <- read_csv(here("data", "warming.csv")) %>% 
  select(-1)
damages <- read_csv(here("data", "damages.csv")) #in degrees C
```

### Question 1

Using damages.csv, estimate a quadratic damage function relating the dollar value of damages
to the change in global mean temperature. Estimate a model with a zero intercept because
damages by construction must equal zero when there is no climate change. Plot your estimated
damage function, overlaid with a scatterplot of the underlying data.

```{r}
#make a new column with warming^2 to derive a quadratic model
damages <- damages %>% 
  mutate(warming2 = warming^2)

#run a linear regression using the new warming^2 and the original warming 
damages_model <- lm(damages ~ 0 + warming + warming2, data = damages)

summary(damages_model)

#make a function out of the model results 
damages_function <- function(x){
  damages_model$coefficients[1]*x+damages_model$coefficients[2]*x^2
}

#output equation
extract_eq(model = damages_quad_model, use_coefs = TRUE, coef_digits = 2)
```


```{r}
ggplot(data = damages, aes(x = warming, y = damages)) +
  geom_point(alpha = 0.2, size = 1.8, color = "sienna")+
  stat_function(fun = damages_function, color = "slateblue4", size = 1) +
  theme_classic()+
  labs(x = "\nWarming (Degrees C)",
       y = "Damages ($)\n",
       title = "Damages vs. Global Temperature Change") +
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"), 
    title = element_text(face = "bold"))
```


### Question 2

Use warming.csv and your estimated damage function to predict damages in each year under
the baseline climate and the pulse scenario. Make four plots: (1) damages over time without
the pulse, (2) damages over time with the pulse, (3) the difference in damages over time that
arises from the pulse, and (4) the difference in damages over time from the pulse per ton of
CO2 (you can assume that each ton of the pulse causes the same amount of damage).

```{r}
# assign value to one-time pulse of 35billion tons CO2
pulse <- 35000000000

# create new df with values for damages under baseline and pulse scenarios
warming_damages <- warming %>%
  mutate(damages_baseline = damages_function(warming_baseline)) %>%
  mutate(damages_pulse = damages_function(warming_pulse)) %>%
  mutate(damages_diff = damages_pulse - damages_baseline) %>%
  mutate(damages_diff_co2 = damages_diff/pulse)

# plot damages over time without pulse
ggplot(data = warming_damages, aes(x = year, y = damages_baseline)) +
  geom_line(color = "slateblue4", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Baseline scenario damages ($)\n") +
  
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"))

# plot damages over time with pulse
ggplot(data = warming_damages, aes(x = year, y = damages_pulse)) +
  geom_line(color = "coral", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Pulse scenario damages ($)\n") +
  
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"))


# plot difference in damages over time from pulse
ggplot(data = warming_damages, aes(x = year, y = damages_diff)) +
  geom_line(color = "forestgreen", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Difference in damages ($)\n") +
  
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"))


# plot difference in damages over time from pulse per ton CO2
ggplot(data = warming_damages, aes(x = year, y = damages_diff_co2)) +
  geom_line(color = "goldenrod", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Difference in damages per ton CO2 ($)\n") +
  
  theme(
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"))
```

### Question 3
The SCC is the present discounted value of the stream of future damages caused by one
additional ton of CO2. The Obama Administration used a discount rate of 3% to discount
damages. Recently, New York State used a discount rate of 2%. Calculate and make a plot
of the SCC (y-axis) against the discount rate (x-axis) for a reasonable range of discount rates.
Explain the intuition for how the discount rate affects the SCC.


