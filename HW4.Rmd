---
title: "hw4"
author: "Nick McManus"
date: "5/21/2022"
output: 
  html_document:
    code_folding: hide
    theme: cerulean
    toc: yes
    toc_float: yes
    collapsed: yes
    smooth_scroll: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(equatiomatic)
```

```{r}
# read in data
warming <- read_csv(here("data", "warming.csv")) %>% 
  select(-1)
damages <- read_csv(here("data", "damages.csv")) #in degrees C
```

### Question 1: Estimated Damages

Using `damages.csv`, estimate a quadratic damage function relating the dollar value of damages to the change in global mean temperature. Estimate a model with a zero intercept because damages by construction must equal zero when there is no climate change. Plot your estimated damage function, overlaid with a scatterplot of the underlying data.

```{r}
# create new column with squared values to derive quadratic model
damages <- damages %>% 
  mutate(warming_sq = warming^2)

# run regression using the squared and original warming values
damages_model <- lm(damages ~ 0 + warming + warming_sq, data = damages)

# summary(damages_model)

# make quadratic function from the model
damages_fxn <- function(x){
  damages_model$coefficients[1]*x+damages_model$coefficients[2]*x^2
}

# output equation
extract_eq(model = damages_model, use_coefs = TRUE, coef_digits = 2)
```


```{r}
# plot estimated damage function overlaid with scatterplot
ggplot(data = damages, aes(x = warming, y = damages)) +
  geom_point(alpha = 0.3, size = 1.4, color = "sienna")+
  stat_function(fun = damages_fxn, color = "slateblue4", size = 1) +
  theme_classic() +
  theme(title = element_text(face = "bold")) +
  labs(x = "\nWarming (degrees C)",
       y = "Damages ($)\n",
       title = "Estimated Damages with Global Temperature Change")
```


### Question 2: Damages under different scenarios

Use `warming.csv` and your estimated damage function to predict damages in each year under
the baseline climate and the pulse scenario. Make four plots: (1) damages over time without
the pulse, (2) damages over time with the pulse, (3) the difference in damages over time that
arises from the pulse, and (4) the difference in damages over time from the pulse per ton of
CO2 (you can assume that each ton of the pulse causes the same amount of damage).

```{r}
# assign value to one-time pulse of 35 billion tons CO2
pulse <- 35000000000

# create new dataframe with values for damages under baseline and pulse scenarios
warming_damages <- warming %>%
  mutate(damages_baseline = damages_fxn(warming_baseline)) %>%
  mutate(damages_pulse = damages_fxn(warming_pulse)) %>%
  mutate(damages_diff = damages_pulse - damages_baseline) %>%
  mutate(damages_diff_co2 = damages_diff/pulse)


# plot damages over time without pulse
ggplot(data = warming_damages, aes(x = year, y = damages_baseline)) +
  geom_line(color = "slateblue4", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Baseline scenario damages ($)\n",
       title = "Estimated Damages without CO2 Pulse") +
    theme(title = element_text(face = "bold"))


# plot damages over time with pulse
ggplot(data = warming_damages, aes(x = year, y = damages_pulse)) +
  geom_line(color = "coral", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Pulse scenario damages ($)\n",
       title = "Estimated Damages with CO2 Pulse") +
  theme(title = element_text(face = "bold"))


# plot difference in damages over time from pulse
ggplot(data = warming_damages, aes(x = year, y = damages_diff)) +
  geom_line(color = "forestgreen", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Difference in damages ($)\n",
       title = "Damages Difference from CO2 Pulse") +
  theme(title = element_text(face = "bold"))


# plot difference in damages over time from pulse per ton CO2
ggplot(data = warming_damages, aes(x = year, y = damages_diff_co2)) +
  geom_line(color = "goldenrod", size = 1) +
  theme_classic() +
  labs(x = "\nYear",
       y = "Difference in damages per ton CO2 ($)\n",
       title = "Damages Differences from Pulse per ton CO2") +
    theme(title = element_text(face = "bold"))
```

### Question 3: Social Cost of Carbon

The SCC is the present discounted value of the stream of future damages caused by one
additional ton of CO2. The Obama Administration used a discount rate of 3% to discount
damages. Recently, New York State used a discount rate of 2%. Calculate and make a plot
of the SCC (y-axis) against the discount rate (x-axis) for a reasonable range of discount rates.
Explain the intuition for how the discount rate affects the SCC.


```{r}
# assign value to starting year of 2022
baseline_year <- 2022

# create new dataframe with present values from discount rates from 0 to 10%
warming_damages_scc <- warming_damages %>%
  select(year, damages_diff_co2) %>%
  mutate(pv_0 = damages_diff_co2*((1+0.0)^(-(year-baseline_year)))) %>%
  mutate(pv_1 = damages_diff_co2*((1+0.01)^(-(year-baseline_year)))) %>%
  mutate(pv_2 = damages_diff_co2*((1+0.02)^(-(year-baseline_year)))) %>%
  mutate(pv_3 = damages_diff_co2*((1+0.03)^(-(year-baseline_year)))) %>%
  mutate(pv_4 = damages_diff_co2*((1+0.04)^(-(year-baseline_year)))) %>%
  mutate(pv_5 = damages_diff_co2*((1+0.05)^(-(year-baseline_year)))) %>%
  mutate(pv_6 = damages_diff_co2*((1+0.06)^(-(year-baseline_year)))) %>%
  mutate(pv_7 = damages_diff_co2*((1+0.07)^(-(year-baseline_year)))) %>%
  mutate(pv_8 = damages_diff_co2*((1+0.08)^(-(year-baseline_year)))) %>%
  mutate(pv_9 = damages_diff_co2*((1+0.09)^(-(year-baseline_year)))) %>%
  mutate(pv_10 = damages_diff_co2*((1+0.1)^(-(year-baseline_year))))

discount_rates <- c(0,1,2,3,4,5,6,7,8,9,10)
scc_calc <- c(sum(warming_damages_scc$pv_0),sum(warming_damages_scc$pv_1),
                       sum(warming_damages_scc$pv_2),sum(warming_damages_scc$pv_3),
                       sum(warming_damages_scc$pv_4),sum(warming_damages_scc$pv_5),
                       sum(warming_damages_scc$pv_6),sum(warming_damages_scc$pv_7),
                       sum(warming_damages_scc$pv_8),sum(warming_damages_scc$pv_9),
                       sum(warming_damages_scc$pv_10))

scc_df <- data.frame(discount_rates,
                     scc_calc)

```


```{r}
# plot the discount rates and SCC
ggplot(data = scc_df, aes(x = discount_rates, y = scc_calc)) +
  geom_point(color = "black") +
  theme_classic() +
  labs(x = "\nDiscount rate (%)",
       y = "SCC ($/ton of CO2)\n",
       title = "SCC at Various Discount Rates") 
```


### Question 4: Ramsey Rule

The National Academies of Sciences, Engineering, and Medicine advised the government in a
2017 report to use the Ramsey Rule when discounting within the SCC calculation:
r = ρ + ηg
Using ρ = 0.001, η = 2, and g = 0.01, what is the SCC? Locate this point on your graph from
above.

```{r}
# find the discount rate (as percent) according to NASEM
r_ramsey <- (0.001 + (2*0.01))*100

# use ramsey discount rate to calculate SCC
warming_damages_ramsey <- warming_damages %>%
  select(year, damages_diff_co2) %>%
  mutate(pv_ramsey = damages_diff_co2*((1+(r_ramsey/100))^(-(year-baseline_year))))
scc_ramsey <- sum(warming_damages_ramsey$pv_ramsey)

```


```{r}
# plot with Ramsey Rule discount rate

ggplot(data = scc_df, aes(x = discount_rates, y = scc_calc)) +
  geom_point(color = "black", size = 2, alpha = 0.3) +
  theme_classic() +
  labs(x = "\nDiscount rate (%)",
       y = "SCC ($/ton of CO2)\n",
       title = "SCC of Ramsey Rule") +
  geom_vline(xintercept = 2.1, color = "slateblue1") +
  geom_label(aes(x = 2.1, label = "Ramsey Rule: SCC = $71.35", y = 90), colour="slateblue4", angle = 90) +
  geom_point(aes(x = 2.1, y = 71.35), color = "slateblue1", size = 2)
```


### Question 5: 

Now suppose there are two possible climate policies that can be pursued. Policy A is business as usual and Policy B is to take immediate and strong action on climate change. Use these facts:
- If you undertake Policy A there are two possible outcomes. Either warming will occur as in the “baseline” (i.e. “no-pulse”) dataset above (this happens with probability 0.5) or warming each year will be 1.5 times that in the “baseline” dataset (with probability 0.5).
- Under Policy B, warming will continue until 2050 as in the “baseline” dataset, and then will stabilize at 1.29 degrees and stay that way forever.
- Society is risk neutral
- Use a discount rate of 2%


What is the expected present value of damages up to 2100 under Policy A? What is the
expected present value of damages up to 2100 under Policy B? Suppose undertaking Policy A
costs zero and undertaking Policy B costs X. The total cost of a policy is the implementation
cost plus expected damages. Make a plot of total cost of Policy A and total cost of Policy B
against X. Suppose Congress wants to undertake the policy with the lower total cost. Use your graph to advise Congress.






